# [ASP.NET Core fundamentals overview](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/)
ASP.NET Core应用只是个简单的创建Web Server的控制台应用程序。
``` C#
using System;
using Microsoft.AspNetCore.Hosting;

namespace aspnetcoreapp
{
    public class Program
    {
        var host=new WebHostBuilder()
            .UserKestrel()
            .UseStartup<Startup>()
            .Build();

            host.Run();
    }
}

```
说明：
- WebHostBuilder使用建造者模式创建Web Application Host；
- WebHostBuilder-UseIISIntegration：使用IIS或IIS Express作为宿主容器；
- WebHostBuilder-UseContentRoot：指明程序根目录（root content directory）；
- WebHostBuilder-Build：创建IWebHost对象用来寄宿（host）应用程序；
- WebHostBuilder-Run：启动应用程序，开始监听HTTP请求。
## 1 [Startup](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/startup)
WebHostBuilder对象的UseStartup方法用来指明应用程序的Startup类。
- 该类主要用来定义请求处理管道（**Request Handing Pipeline**）及配置服务（**Services Configure**）；
- 该类必须为**public**类型；
- 该类默认包含以下两方法，应用启动时被调用（called）；
  -  ConfigureServices（**可选**）定义应用程序所需要的服务；
  -  Configure（**必须**）指明应用如何响应HTTP请求，通过依赖注入在`IApplicationBuilder`中注入中间件（**middleware**）来配置请求管道。
    ``` C#
    public class Startup
    {
        public void ConfigureServices(IServiceCollection services)
        {
        }

        public void Configure(IApplicationBuilder app)
        {
        }
    }

    ```
- ASP.NET Core应用需要一个`Startup`类，默认情况下命名为Startup，可通过UseStartup<TStartup>方法指定自定义的`Startup`类名；
- 在不同的环境下可定义不同的`Startup`类，运行时（**runtime**）会自动选择合适的`Startup`；
- 若在WebHost配置选项中指明`startupAssembly`，则宿主会加载对应程序集，并在其中搜索`Startup`或`Startup[Environment]`的对象的类型，参见[StartupLoader类的FindStartupType](https://github.com/aspnet/Hosting/blob/rel/1.1.0/src/Microsoft.AspNetCore.Hosting/Internal/StartupLoader.cs)；
    ``` C#        
    //查找程序集的Startup类        
    public static Type FindStartupType(string startupAssemblyName, string environmentName)
    {
        if (string.IsNullOrEmpty(startupAssemblyName))
        {
            throw new ArgumentException(
                string.Format("A startup method, startup type or startup assembly is required. If specifying an assembly, '{0}' cannot be null or empty.",
                nameof(startupAssemblyName)),
                nameof(startupAssemblyName));
        }

        var assembly = Assembly.Load(new AssemblyName(startupAssemblyName));
        if (assembly == null)
        {
            throw new InvalidOperationException(String.Format("The assembly '{0}' failed to load.", startupAssemblyName));
        }

        var startupNameWithEnv = "Startup" + environmentName;
        var startupNameWithoutEnv = "Startup";

        // Check the most likely places first
        var type =
            assembly.GetType(startupNameWithEnv) ??
            assembly.GetType(startupAssemblyName + "." + startupNameWithEnv) ??
            assembly.GetType(startupNameWithoutEnv) ??
            assembly.GetType(startupAssemblyName + "." + startupNameWithoutEnv);

        if (type == null)
        {
            // Full scan
            var definedTypes = assembly.DefinedTypes.ToList();

            var startupType1 = definedTypes.Where(info => info.Name.Equals(startupNameWithEnv, StringComparison.Ordinal));
            var startupType2 = definedTypes.Where(info => info.Name.Equals(startupNameWithoutEnv, StringComparison.Ordinal));

            var typeInfo = startupType1.Concat(startupType2).FirstOrDefault();
            if (typeInfo != null)
            {
                type = typeInfo.AsType();
            }
        }

        if (type == null)
        {
            throw new InvalidOperationException(String.Format("A type named '{0}' or '{1}' could not be found in assembly '{2}'.",
                startupNameWithEnv,
                startupNameWithoutEnv,
                startupAssemblyName));
        }

        return type;
    }       
    ```
- Startup类的构造函数可通过依赖注入（**Dependency Injection**）注入相关依赖项；
  - IHostingEnvironment：添加配置；
  - ILoggerFactory：设置日志；
  - [x] 待添加
## 2 Services
## 3 Middleware
## 4 Servers
## 5 Content root
## 6 Web root
## 7 Configuration
## 8 Environments
## 9 .NET Core vs .NET Framework runtime
## 10 Additional